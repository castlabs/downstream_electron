/*!
 * downstream-electron,0.3.5,2019-02-28 20:56:15.008,castlabs GmbH
 * 
 * Copyright (C) 2017 Castlabs GmbH.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("electron"),require("express"),require("cors"));else if("function"==typeof define&&define.amd)define(["electron","express","cors"],t);else{var n="object"==typeof exports?t(require("electron"),require("express"),require("cors")):t(e.electron,e.express,e.cors);for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(global,function(e,t,n){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=109)}({1:function(e,t,n){"use strict";var o=n(2).app,r=n(3),s={downloadingThreadsRules:{items:[{max:10,files:5},{max:100,files:10},{max:1e3,files:30},{max:1e5,files:50}],threads:[{size:10,number:1},{size:100,number:3},{size:1e3,number:4},{size:1e5,number:5}]},MAX_ERRORS_DOWNLOAD_RETRY:5,MAX_INTERNET_ERRORS_DOWNLOAD_CHUNK_RETRY:100,MAX_ERRORS_DOWNLOAD_CHUNK_RETRY:5,offlineDomain:"http://127.0.0.1",offlineContentPortStart:3010,maxOfflineContentPortRange:3030,numberOfManifestsInParallel:2,stopOnError:!1,stores:{DOWNLOADS:{LEFT:"left",DOWNLOADING:"downloading",DOWNLOADED:"downloaded",ERRORS:"errors"},STATUS:"status",PARAMS:"params",MANIFEST:"manifest",PERSISTENT:"persistent",DATA:"data"},saveToDisk:!0,times:{DOWNLOAD_TIMEOUT:5e3,RETRY_TIMEOUT:5e3},useChunkedEncoding:!1,useHeadRequests:!0,noCache:!1,defaultManifestRequestOptions:{headers:{Accept:"*/*","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Electron/1.8.6 Safari/537.36"},timeout:5e3},customManifestIdFolderRegex:/^([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\-|\_){1,1}([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\ |\,|\.|\;|\'|\[|\]|\{|\}|\!|\@|\#|\$|\%|\&|\*|\(|\)|\-|\_|\=|\+?){0,49}$/i,openingTagForInvalidCustomManifestIdCharacter:"<span style='background-color:blue;'>",closingTagForInvalidCustomManifestIdCharacter:"</span>"};t.load=function(e){var t=o.getPath("userData"),n="settings",i="public",a="movies";e&&(e.appDir&&(t=e.appDir),e.settingsName&&(n=e.settingsName),e.publicName&&(i=e.publicName),e.downloadsName&&(a=e.downloadsName),e.offlineDomain&&(s.offlineDomain=e.offlineDomain),e.offlineContentPortStart&&(s.offlineContentPortStart=e.offlineContentPortStart),e.maxOfflineContentPortRange&&(s.maxOfflineContentPortRange=e.maxOfflineContentPortRange),e.numberOfManifestsInParallel&&(s.numberOfManifestsInParallel=e.numberOfManifestsInParallel),void 0!==e.stopOnError&&(s.stopOnError=e.stopOnError),e.customManifestIdFolderRegex&&(s.customManifestIdFolderRegex=e.customManifestIdFolderRegex),e.openingTagForInvalidCustomManifestIdCharacter&&(s.openingTagForInvalidCustomManifestIdCharacter=e.openingTagForInvalidCustomManifestIdCharacter),e.closingTagForInvalidCustomManifestIdCharacter&&(s.closingTagForInvalidCustomManifestIdCharacter=e.closingTagForInvalidCustomManifestIdCharacter),void 0!==e.useHeadRequests&&(s.useHeadRequests=e.useHeadRequests),e.times&&e.times.RETRY_TIMEOUT&&(s.times.RETRY_TIMEOUT=e.times.RETRY_TIMEOUT),e.MAX_ERRORS_DOWNLOAD_RETRY&&(s.MAX_ERRORS_DOWNLOAD_RETRY=e.MAX_ERRORS_DOWNLOAD_RETRY),e.MAX_INTERNET_ERRORS_DOWNLOAD_CHUNK_RETRY&&(s.MAX_INTERNET_ERRORS_DOWNLOAD_CHUNK_RETRY=e.MAX_INTERNET_ERRORS_DOWNLOAD_CHUNK_RETRY),e.MAX_ERRORS_DOWNLOAD_CHUNK_RETRY&&(s.MAX_ERRORS_DOWNLOAD_CHUNK_RETRY=e.MAX_ERRORS_DOWNLOAD_CHUNK_RETRY),e.noCache&&(s.noCache=e.noCache)),t=r.join(r.resolve(t),"/");var u=r.join(r.resolve(t+n)+"/","/"),f=r.join(r.resolve(t+i)+"/","/"),l=r.join(r.resolve(f+a)+"/","/");s.appDir=t,s.downloadsFolderPath=l,s.downloadsName=a,s.publicFolderPath=f,s.settingsFolder=u},t.getSettings=function(){return s}},109:function(e,t,n){e.exports=n(110)},110:function(e,t,n){"use strict";var o=n(111),r=n(112);!function(){process.send({cmd:"log",log:"Starting HTTP server"});var e=o();e.use(r()),process.on("message",function(t){"init"===t.cmd&&(n(113)(e,t.routeName),e.listen(t.port,function(){process.send({cmd:"listening_port",port:t.port})}))})}()},111:function(e,n){e.exports=t},112:function(e,t){e.exports=n},113:function(e,t,n){"use strict";var o=n(5),r=0,s={};function i(e,t){var n=function(){var e=(new Date).getTime();return++r+"-"+e}(),o=new Promise(function(e,t){s[n]={resolve:e,reject:t}}),i={};return i.requestId=n,i.cmd=e,i.args=t,process.send(i),o}function a(e){var t=e.requestId,n=e.error,o=e.result,r=s[t+""];r&&("OK"===e.status?function(e){r.resolve(e)}(o):r.reject(n),delete s[t])}e.exports=function(e,t){var n={};process.on("message",a),e.get("/"+t+"/:id/*",function(e,t){var r=e.params.id,s=function(e){t.sendFile(e,{dotfiles:"deny"},function(e){e&&e.status&&(delete n[r],t.status(e.status).end())})},a=function(a){if(a&&"FINISHED"===a.status){var u=a.folder+"/"+r+"/"+e.params[0];o.checkForLocalFile(u,function(e){if(!e)return delete n[r],t.status(404).end();s(u)})}else!function(n){var a=n+"/"+r+"/"+e.params[0];o.checkForLocalFile(a,function(e){e?i("is_downloading",{manifest:r,file:a}).then(function(){s(a)}).catch(function(){return t.status(404).end()}):i("perform_seek",{manifest:r,file:a}).then(function(){s(a)}).catch(function(){return t.status(404).end()})})}(a.folder)};n[r]?a(n[r]):i("get_info",{manifest:r}).then(function(e){n[r]=e,a(n[r])}).catch(function(){return delete n[r],t.status(404).send("Cannot find manifest")})})}},2:function(t,n){t.exports=e},3:function(e,t){e.exports=require("path")},4:function(e,t){e.exports=require("fs")},5:function(e,t,n){"use strict";var o=n(4),r=n(1),s=Object.assign({start:0,end:null},r.getSettings().defaultManifestRequestOptions);e.exports={checkForLocalFile:function(e,t){o.stat(e,function(e,n){e?t(!1):t(!0,n.size)})},defaultOptions:s,errors:{ABORTED:"ABORTED",CHUNK_ERROR:"CHUNK_ERROR",CHUNK_SIZE_ERROR:"CHUNK_SIZE_ERROR",FILE_CREATING_ERROR:"FILE_CREATING_ERROR",FILE_WRITING_ERROR:"FILE_WRITING_ERROR",NO_SPACE_LEFT_ERROR:"NO_SPACE_LEFT_ERROR",INTERNET:"INTERNET",TIMEOUT:"TIMEOUT"}}}})});