/*!
 * downstream-electron,0.3.5,2019-02-28 20:56:15.008,castlabs GmbH
 * 
 * Copyright (C) 2017 Castlabs GmbH.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("electron"));else if("function"==typeof define&&define.amd)define(["electron"],t);else{var o="object"==typeof exports?t(require("electron")):t(e.electron);for(var r in o)("object"==typeof exports?exports:e)[r]=o[r]}}(global,function(e){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=107)}({0:function(e,t,o){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=o(17),s=o(18),i=o(7),d=/%[A-Za-z0-9_-]+%/g,a={};function f(e,t){var o=e;return"object"===(void 0===o?"undefined":r(o))&&(o=o.msg),o=o?function(e,t){if((t=t||"")instanceof Array)for(var o=l(e.match(d)),n=0,s=Math.min(o.length,t.length);n<s;n++)e=e.replace(new RegExp(o[n],"g"),t[n]);else if("object"===(void 0===t?"undefined":r(t))){for(var i in t)t.hasOwnProperty(i)&&(e=e.replace(new RegExp("%"+i+"%","g"),t[i]));e=e.replace(d,t)}else"string"!=typeof t&&"number"!=typeof t&&"boolean"!=typeof t||(e=e.replace(d,t));return e}(o,t):"Internal Error"}function c(e){for(var t=[],o=1,r=e.length;o<r;o++)t.push(e[o]);return 0===t.length?t=void 0:1===t.length&&(t=t[0]),t}function l(e){for(var t={},o=[],r=0,n=(e=e||[]).length;r<n;r++)t[e[r]]||(t[e[r]]=!0,o.push(e[r]));return o}a.getError=function(e){var t=c(arguments),o=function(e,t){var o=e,n=[];if("object"===(void 0===o?"undefined":r(o))&&(o=o.msg),o)if(t instanceof Array)for(var s=l(o.match(d)),i=0,a=Math.min(s.length,t.length);i<a;i++){var f={};f[s[i].replace(/%/g,"")]=t[i],n.push(f)}else if("object"===(void 0===t?"undefined":r(t))){for(var c in t)if(t.hasOwnProperty(c)){var u={};u[c]=t[c],n.push(u)}}else if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)for(var p=o.match(d)||[],R=0,m=p.length;R<m;R++){var h={};h[p[R].replace(/%/g,"")]=t,n.push(h)}return n&&!n.length&&(n=void 0),n}(e,t),n=f(e,t);return{code:function(e){var t=(e=e||{}).code;return t||(t=i.GENERAL),t}(e),msg:n,keys:o}},a.getTranslation=function(e){return f(e,c(arguments))},a.e=n,a.t=s,e.exports=a},107:function(e,t,o){e.exports=o(108)},108:function(e,t,o){"use strict";var r="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",n=o(2).remote,s=o(2).ipcRenderer,i=o(0),d=void 0;function a(e,t){return function(){t.apply(e,arguments)}}function f(e,t){var o=n.getCurrentWindow();o&&(this._windowId=o.id),this._promisesObj={},this._subscribersId={},this._promiseCounter=0,this._window=e,this._persistent=t,function(e){for(var t=1,o=arguments.length;t<o;t++){var r=arguments[t];e[r]=a(e,e[r])}}(this,"_processApi","_beforeUnload"),this._createApiMethods("downloads",["create","createPersistent","getFolderInfo","getList","getListWithInfo","getOfflineLink","info","remove","removeAll","removeAllUnfinished","removePersistent","resume","saveData","savePersistent","start","stop","stopAll","subscribe","unsubscribe","updateDownloadFolder"]),this._attachEvents()}f.prototype.downloads={},f.prototype.downloads.createPersistent=function(e,t,o){var n=e[0],s=e[1],d=e[2],a=this;this._persistent?this.downloads.info(n).then(function(e){if(e){var f=e.persistent;f&&!d?o("persistent session already exists:"+JSON.stringify(f)):(s.pssh||(s.pssh=function(e){var t=e.manifestInfo.protections,o=t.video[0]||{};t.video&&e.manifest.video&&(o=(o=t.video.filter(function(t){return e.manifest.video.indexOf(t.id)>=0}))[0]||{});for(var n=o.protections||[],s=void 0,i=0,d=n.length;i<d;i++)if(n[i].schemeIdUri===r){s=n[i].cencPSSH;break}return s}(e)),a._persistent.createPersistentSession(s).then(function(e){a.downloads.savePersistent(n,e).then(function(){f?a._persistent.removePersistentSession(f).then(function(){t(e)}).catch(function(){t(e)}):t(e)},o)},o))}else o(i.getError(i.e.manifests.NOT_FOUND,n))},o):o("No persistent plugin initialized")},f.prototype.downloads.removePersistent=function(e,t,o,r){this._persistent?r&&r.persistent?this._persistent.removePersistentSession(r.persistent).then(t,o):t():o("No persistent plugin initialized")},f.prototype.downloads.remove=function(e,t,o,r){this._persistent&&r&&r.persistent?this._persistent.removePersistentSession(r.persistent).then(t,o):t()},f.prototype.downloads.removeAll=function(e,t,o,r){var n=(r=r||[]).filter(function(e){return!!e.persistent}).map(function(e){return e.persistent});if(this._persistent&&n.length>0){for(var s=[],i=0,d=n.length;i<d;i++)s.push(this._persistent.removePersistentSession(n[i]));Promise.all(s).then(t,o)}else t()},f.prototype._apiCall=function(e,t,o){var r=this,n=this._generatePromiseId(),s=new Promise(function(s,i){r._promisesObj[n]={resolve:s,reject:i,method:e,args:t,originalMethod:o}}),i={};return i.promiseId=n,i.method=e,i.windowId=this._windowId,i.args=t,this._send(i),s},f.prototype._attachEvents=function(){o(2).ipcRenderer.on("downstreamElectronFE",this._processApi),this._window.addEventListener("beforeunload",this._beforeUnload)},f.prototype._beforeUnload=function(){this._removeSubscribers()},f.prototype._createApiMethods=function(e,t){function o(e,t,o){var r=void 0;"function"==typeof e[t][o]&&(r=e[t][o]),e[t][o]=function(e,t,o){return function(){return e._apiCall(t,arguments,o)}}(e,t+"."+o,r)}this[e]=this[e]||{};for(var r=0,n=t.length;r<n;r++)o(this,e,t[r])},f.prototype._executeSubscriber=function(e,t,o,r){var n=this._subscribersId[e];n&&n.callback(t,o),r&&n&&this._removeLocalSubscribers(n.manifestId)},f.prototype._generatePromiseId=function(){var e=(new Date).getTime();return this._promiseCounter++,this._promiseCounter+"-"+e},f.prototype._processApi=function(e,t){var o=t.promiseId,r=t.error,n=t.result,s=this._promisesObj[o+""];function i(e){s.resolve(e),this._removeLocalSubscribersForDefinedMethods(s.method,s.args[0]||e)}s?("OK"===t.status?"function"==typeof s.originalMethod?s.originalMethod.call(this,s.args,i.bind(this),s.reject.bind(this),n):i.call(this,n):s.reject(r),t.subscribersId&&this._saveSubscribersId(s,t.subscribersId),delete this._promisesObj[o]):t.subscriberId&&this._executeSubscriber(t.subscriberId,t.err,n,t.subscriberFinished)},f.prototype._removeSubscribers=function(){var e={},t=void 0;for(var o in t=[],this._subscribersId)this._subscribersId.hasOwnProperty(o)&&t.push(o);e.method="removeSubscribers",e.args=[t],this._send(e)},f.prototype._removeLocalSubscribers=function(e){var t=this;function o(o){for(var r=0,n=e.length;r<n;r++)if("string"==typeof t._subscribersId[o].manifestId){if(t._subscribersId[o].manifestId===e[r]){delete t._subscribersId[o];break}}else{var s=t._subscribersId[o].manifestId.indexOf(e[r]);if(s>=0&&t._subscribersId[o].manifestId.splice(s,1),!t._subscribersId[o].manifestId.length){delete t._subscribersId[o];break}}}if("string"==typeof e?e=[e]:e instanceof Array&&(e=e.map(function(e){return"string"==typeof e?e:e.manifestInfo&&e.manifestInfo.id})),e)for(var r in this._subscribersId)this._subscribersId.hasOwnProperty(r)&&o(r);else this._subscribersId={}},f.prototype._removeLocalSubscribersForDefinedMethods=function(e,t){var o=["downloads.stop","downloads.stopAll","downloads.remove","downloads.removeAll","downloads.removeAllUnfinished","downloads.unsubscribe"];"downloads.removeAll"!==e&&"downloads.stopAll"!==e||(t=void 0);for(var r=0,n=o.length;r<n;r++)if(e===o[r]){this._removeLocalSubscribers(t);break}},f.prototype._saveSubscribersId=function(e,t){var o,r=void 0;for("string"!=typeof t&&"number"!=typeof t||(t=[String(t)]),r=0,o=t.length;r<o;r++)this._subscribersId[t[r]]={manifestId:e.args[0],callback:e.args[2+r]}},f.prototype._send=function(e){try{s.send("downstreamElectronBE",e)}catch(e){console.error(e)}},e.exports={init:function(e,t){return d||(d=new f(e,t)),d}}},17:function(e,t,o){"use strict";var r=o(7),n={downloads:{_GENERAL:{code:r.ERRORS.INTERNAL_ERROR,msg:"Sorry we are unable to process your request - some internal error occurred"},ALREADY_FINISHED:{code:r.ERRORS.FINISHED,msg:"This download '%manifestId%' has been already finished."},ALREADY_REMOVED_ALL_UNFINISHED:{code:r.ERRORS.REMOVED,msg:"All unfinished downloads have been already removed, nothing left."},ALREADY_RESUMED:{code:r.ERRORS.RESUMED,msg:"This download '%manifestId%' has been already resumed."},ALREADY_STOPPED:{code:r.ERRORS.STOPPED,msg:"This download '%manifestId%' has been already stopped or has been already downloaded."},ALREADY_STOPPED_ALL:{code:r.ERRORS.STOPPED,msg:"There are no downloads to be stopped."},ALREADY_STARTED:{code:r.ERRORS.STARTED,msg:"This download '%manifestId%' has been already started."},BROKEN_CANNOT_BE_RESUMED:{code:r.ERRORS.BROKEN,msg:"This download '%manifestId%' is broken and cannot be resumed."},INFO_FAILED:{code:r.ERRORS.INFO,msg:"Gettting info of download '%manifestId%' failed."},REMOVING_ALL_FAILED:{code:r.ERRORS.INTERNAL_ERROR,msg:"Removing of all downloads failed."},REMOVING_ALL_UNFINISHED_FAILED:{code:r.ERRORS.INTERNAL_ERROR,msg:"Removing of all unfinished downloads failed."},REMOVING_FAILED:{code:r.ERRORS.INTERNAL_ERROR,msg:"Removing of download '%manifestId%' failed."},RESUMING_FAILED:{code:r.ERRORS.INTERNAL_ERROR,msg:"Resuming of download '%manifestId%' failed."},UPDATE_DOWNLOAD_FOLDER_FAILED:{code:r.ERRORS.INTERNAL_ERROR,msg:"Updating of download folder for '%manifestId%' failed."},STOPPING_FAILED:{code:r.ERRORS.INTERNAL_ERROR,msg:"Stopping of download '%manifestId%' failed."},SAVING_PERSISTENT_FAILED:{code:r.ERRORS.INTERNAL_ERROR,msg:"Saving persistent info for download '%manifestId%' failed."},SAVING_DATA_FAILED:{code:r.ERRORS.INTERNAL_ERROR,msg:"Saving data for download '%manifestId%' failed."},STOPPING_ALL_FAILED:{code:r.ERRORS.INTERNAL_ERROR,msg:"Stopping all downloads failed."},UNFINISHED:{code:r.ERRORS.UNFINISHED,msg:"This download is not ready yet."}},manifests:{NOT_FOUND:{code:r.ERRORS.NOT_FOUND,msg:"Manifest with id='%manifestId%' not found."},LOADING_FAILED:{code:r.ERRORS.LOADING,msg:"Could not load manifest from url '%manifestUrl%'."},LIST_LOADING_FAILED:{code:r.ERRORS.LOADING,msg:"Could not load list of manifests."},FOLDER_ALREADY_EXISTS:{code:r.ERRORS.EXISTS,msg:"Folder for manifest with id ='%manifestId%' already exists."},INVALID_ID:{code:r.ERRORS.BROKEN,msg:"Provided custom id for manifest is not valid: ('%invalid%')"}}};e.exports=n},18:function(e,t,o){"use strict";e.exports={test:"Hello world"}},2:function(t,o){t.exports=e},7:function(e,t,o){"use strict";e.exports={GENERAL:-1,ERRORS:{INTERNAL_ERROR:1,BROKEN:11,FINISHED:12,UNFINISHED:13,STOPPED:14,CREATED:15,MISSING:16,RESUMED:17,STARTED:18,LOADING:19,REMOVED:20,INFO:21,EXISTS:22,NOT_FOUND:100}}}})});